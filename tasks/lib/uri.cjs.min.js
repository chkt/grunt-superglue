/*
 Licensed under the LGPL 3 (http://www.gnu.org/licenses/lgpl.html)
 Licensed under the LGPL 3 (http://www.gnu.org/licenses/lgpl.html)
 Licensed under the LGPL 3 (http://www.gnu.org/licenses/lgpl.html) 
 Licensed under the LGPL 3 (http://www.gnu.org/licenses/lgpl.html)
 Licensed under the LGPL 3 (http://www.gnu.org/licenses/lgpl.html)
 Licensed under the LGPL 3 (http://www.gnu.org/licenses/lgpl.html)
*/
String.prototype.extendLeft=function(a,b){if("string"!==typeof a)throw new TypeError;void 0===b&&(b=a.length);if("number"!==typeof b||0>b||b<<0!==b)throw new TypeError;for(var c=String(this),e="",d=0,f=b-c.length;d<f;++d)e+=a.charAt(d%b);return e+c};String.prototype.extendRight=function(a,b){if("string"!==typeof a)throw new TypeError;void 0===b&&(b=a.length);if("number"!==typeof b||0>b||b<<0!==b)throw new TypeError;for(var c=String(this),e=c.length;e<b;++e)c+=a.charAt(e%b);return c};
String.prototype.u8CharCodeAt=function(a){if("number"!==typeof a||a<<0!==a)throw new TypeError;var b=String(this);if(0>a||a>=b.length)throw new RangeError;var c=b.charCodeAt(a);if(128>c)return[c.toString(16)];if(55296===(c&63488)){if(c&1024){var e=b.charCodeAt(a-1);a=c;if(e&1)throw Error();}else e=c,a=b.charCodeAt(a+1);56320===(a&56320)&&(c=((e&-55297)<<10|a&-56321)+65536)}e=[];if(2048>c){a=192;var b=1984,d=63,f=6}else 65536>c?(a=224,b=61440,d=4032,f=12):(a=240,b=1835008,d=258048,f=18);e.push((a+
((c&b)>>>f)).toString(16));for(f-=6;0!==d;d>>>=6,f-=6)e.push((128+((c&d)>>f)).toString(16));return e};String.prototype.pctCharAt=function(a){return"%"+this.u8CharCodeAt(a).join("%").toUpperCase()};
String.prototype.u16CharAt=function(a){if("number"!==typeof a||a<<0!==a)throw new TypeError;var b=String(this);if(0>a||a>=b.length)throw new RangeError;var c=b.charCodeAt(a);switch(c&64512){case 56320:if(0>--a)throw new RangeError;a=b.charCodeAt(a);if(55296!==(a&64512))throw Error();return a.toString(16).extendLeft("\\u0000")+c.toString(16).extendLeft("\\u0000");case 55296:if(++a>=b.length)throw new RangeError;a=b.charCodeAt(a);return 56320!==(a&64512)?c.toString(16).extendLeft("\\u0000"):c.toString(16).extendLeft("\\u0000")+
a.toString(16).extendLeft("\\u0000");default:return c.toString(16).extendLeft("\\u0000")}};String.prototype.toU16Chars=function(){for(var a=String(this),b="",c=0,e=a.length;c<e;++c)b+=a.u16CharAt(c);return b};
String.fromUtf8CharCode=function(a){if(!(a instanceof Array))throw new TypeError;for(var b="",c=0,e=a.length;c<e;++c){var d=a[c];if(0===(d&128))b+=String.fromCharCode(d);else{if(0===(d&192))throw Error();if(192===(d&224))var f=224,g=1;else if(224===(d&240))f=240,g=2;else if(240===(d&248))f=248,g=3;else throw Error();d=(d&~f)<<6*g;for(f=1;f<g+1;++f){var h=a[c+f];if(void 0===h||128!==(h&192))throw Error();d|=(h&63)<<6*(g-f)}c+=g;65536>d?b+=String.fromCharCode(d):(d-=65536,b+=String.fromCharCode(55296|
(d&1047552)>>10,56320|d&1023))}}return b};String.fromPctChar=function(a){if("string"!==typeof a)throw new TypeError;a=a.match(/^(?:%[A-Fa-f0-9]{2})+$/);if(null===a)throw Error();a=a[0];for(var b=[],c=a.length-2;-1<c;c-=3)b.unshift(parseInt("0x"+a.substr(c,2)));return String.fromUtf8CharCode(b)};
function StringKeyValue(a,b,c){if(void 0!==a&&("string"!==typeof a||1!==a.length)||void 0!==b&&("string"!==typeof b||1!==b.length)||void 0!==c&&("string"!==typeof c||1!==c.length))throw new TypeError;Object.defineProperty(this,"keyLimit",{value:void 0!==a?a:StringKeyValue.DELIMITER_DEFAULT_KEY,configurable:!0,enumerable:!0});Object.defineProperty(this,"valueLimit",{value:void 0!==b?b:StringKeyValue.DELIMITER_DEFAULT_VALUE,configurable:!0,enumerable:!0});Object.defineProperty(this,"listLimit",{value:void 0!==
c?c:StringKeyValue.SEPERATOR_DEFAULT_VALUE,configurable:!0,enumerable:!0});Object.defineProperty(this,"tokenExpression",{value:new RegExp("^[^"+this.keyLimit.u16CharAt(0)+this.valueLimit.u16CharAt(0)+this.listLimit.u16CharAt(0)+"]+$"),configurable:!0,enumerable:!0});Object.defineProperty(this,"delimiterExpression",{value:new RegExp(this.valueLimit.u16CharAt(0)+"|"+this.listLimit.u16CharAt(0)),configurable:!0,enumerable:!0});this.key=[];this.value={}}
StringKeyValue.prototype.define=function(a,b,c){this.constructor.call(this,a,b,c)};
Object.defineProperty(StringKeyValue.prototype,"string",{get:function(){for(var a=[],b={},c="",e=0,d=this.key[0];void 0!==d;d=this.key[++e]){if("string"!==typeof d||d in b)throw Error();a.push(d);b[d]=e}for(d in this.value)d in b||a.push(d);e=0;for(d=a[0];void 0!==d;d=a[++e]){if(-1===d.search(this.tokenExpression))throw Error();c+=d;if(d in this.value){if(!(this.value[d]instanceof Array))throw Error();if(0!==this.value[d].length)for(var c=c+this.valueLimit,b=0,f=this.value[d][0];void 0!==f;f=this.value[d][++b]){if("string"!==
typeof f||-1===f.search(this.tokenExpression))throw Error();c+=f+this.listLimit}c=c.substring(0,c.length-1)}c+=this.keyLimit}return c.substring(0,c.length-1)},set:function(a){if("string"!==typeof a)throw new TypeError;a=a.split(this.keyLimit);for(var b=[],c={},e={},d=0,f=a[0];void 0!==f;f=a[++d])if(""!==f){var f=f.split(this.delimiterExpression),g=f.shift().trim();if(""!==g){if(g in e)throw Error();b.push(g);e[g]=d;if(0!==f.length){for(var h=f.length-1;-1<h;--h)""===f[h]&&f.splice(h,1);0!==f.length&&
(c[g]=f)}}}this.key=b;this.value=c},configurable:!0,enumerable:!0});
Object.defineProperty(StringKeyValue.prototype,"valid",{get:function(){for(var a=0,b=this.key[0];void 0!==b;b=this.key[++a])if("string"!==typeof b||-1===b.search(this.tokenExpression))return!1;for(b in this.value){if(-1===b.search(this.tokenExpression)||!(this.value[b]instanceof Array))return!1;for(var a=0,c=this.value[b][0];void 0!==c;c=this.value[b][++a])if("string"!==typeof c||-1===c.search(this.tokenExpression))return!1}return!0},configurable:!0,enumerable:!0});
StringKeyValue.prototype.insertKey=function(a,b,c){if("string"!==typeof a||-1===a.search(this.tokenExpression)||!(b instanceof Array)||void 0!==c&&("number"!==typeof c||0>c||c>this.key.length||c<<0!==c))throw Error();c=c||0;for(var e=0,d=b[0];void 0!==d;d=b[++e])if("string"!==typeof d||-1===d.search(this.tokenExpression))throw new TypeError;d=this.key.indexOf(a);-1!==d&&(this.key.splice(d,1),c--);this.key.splice(c,0,a);0!==e&&(this.value[a]=b)};
StringKeyValue.prototype.appendKey=function(a,b){this.insertKey(a,b,this.key.length)};StringKeyValue.prototype.setKey=function(a,b){if("string"!==typeof a||-1===a.search(this.tokenExpression)||!(b instanceof Array))throw new TypeError;for(var c=0,e=b[0];void 0!==e;e=b[++c])if("string"!==typeof e||-1===e.search(this.tokenExpression))throw new TypeError;this.value[a]=b};
StringKeyValue.prototype.getKey=function(a){if("string"!==typeof a||-1===a.search(this.tokenExpression))throw new TypeError;return a in this.value?this.value[a]:null};StringKeyValue.prototype.removeKey=function(a){if("string"!==typeof a||-1===a.search(this.tokenExpression))throw new TypeError;var b=this.key.indexOf(a);-1!==b&&this.key.splice(b,1);a in this.value&&delete this.value[a]};
StringKeyValue.prototype.indexOfKey=function(a){if("string"!==typeof a||-1===a.search(this.tokenExpression))throw new TypeError;var b=this.key.indexOf(a);if(-1!==b)return b;for(var c in this.value)if(c===a)return a.length;return b};StringKeyValue.prototype.copyOf=function(a){if(!(a instanceof this.constructor))throw new TypeError;this.constructor.call(this,a.keyLimit,a.valueLimit,a.listLimit);this.key=a.key.slice(0);this.value={};for(var b in a.value)this.value[b]=a.value[b].slice(0)};
StringKeyValue.prototype.toString=function(){return this.string};Object.defineProperty(StringKeyValue,"VERSION",{value:"0.3.0"});Object.defineProperty(StringKeyValue,"DELIMITER_DEFAULT_KEY",{value:"&",enumerable:!0});Object.defineProperty(StringKeyValue,"DELIMITER_DEFAULT_VALUE",{value:"=",enumerable:!0});Object.defineProperty(StringKeyValue,"SEPERATOR_DEFAULT_VALUE",{value:",",enumerable:!0});
StringKeyValue.String=function(a,b,c,e,d){if(void 0===d)d=new StringKeyValue(b,c,e);else if(d instanceof StringKeyValue)d.define(b,c,e);else throw new TypeError;d.string=a;return d};
StringKeyValue.Key=function(a,b,c,e,d,f){if(!(a instanceof Array&&b&&b.constructor===Object))throw new TypeError;if(void 0===f)f=new StringKeyValue(c,e,d);else if(f instanceof StringKeyValue)f.define(c,e,d);else throw new TypeError;e={};d=0;for(c=a[0];void 0!==c;c=a[++d]){if("string"!==typeof c||c in e||-1===c.search(f.tokenExpression))throw new TypeError;e[c]=d}for(c in b){if(-1===c.search(f.tokenExpression)||!(b[c]instanceof Array))throw new TypeError;e=0;for(d=b[c][0];void 0!==d;d=b[c][++e])if("string"!==
typeof d||-1===d.search(f.tokenExpression))throw new TypeError;}f.key=a;f.value=b};StringKeyValue.Copy=function(a,b){if(void 0===b)b=new StringKeyValue;else if(!(b instanceof StringKeyValue))throw new TypeError;b.copyOf(a);return b};StringKeyValue.toString=function(){return"[StringKeyValue-"+StringKeyValue.VERSION+"]"};
function URI(){Object.defineProperty(this,"scheme",{value:new URIComponent(URIComponent.prototype.TYPE_SCHEME),configurable:!0,enumerable:!0});Object.defineProperty(this,"user",{value:new URIComponent(URIComponent.prototype.TYPE_USER),configurable:!0,enumerable:!0});Object.defineProperty(this,"name",{value:new URIComponent(URIComponent.prototype.TYPE_NAME),configurable:!0,enumerable:!0});Object.defineProperty(this,"port",{value:new URIComponent(URIComponent.prototype.TYPE_PORT),configurable:!0,enumerable:!0});
Object.defineProperty(this,"path",{value:new URIComponent(URIComponent.prototype.TYPE_PATH),configurable:!0,enumerable:!0});Object.defineProperty(this,"query",{value:new URIComponent(URIComponent.prototype.TYPE_QUERY),configurable:!0,enumerable:!0});Object.defineProperty(this,"fragment",{value:new URIComponent(URIComponent.prototype.TYPE_FRAGMENT),configurable:!0,enumerable:!0})}URI.prototype.define=function(){null!==this.name&&this.undefine();URI.call(this);return this};
URI.prototype.undefine=function(){if(null===this.name)for(var a=URI.COMPONENT,b=0,c=a[0];void 0!==c;c=a[++b])Object.defineProperty(this,c,{value:null})};
Object.defineProperty(URI.prototype,"string",{get:function(){var a="",b=this.scheme.valid,c=this.user.valid,e=this.name.valid,d=this.port.valid;b&&(a+=this.scheme.chars+":");c||e||d?(a+="//",c&&(a+=this.user.chars+"@"),e&&(a+=this.name.chars),d&&(a+=":"+this.port.chars),this.path.valid&&(a+=("/"!==this.path.chars[0]?"/":"")+this.path.chars)):b?this.path.valid&&-1===this.path.chars.search(/^\/{2}/)&&(a+=this.path.chars):this.path.valid&&-1===this.path.chars.search(/^(?:\/{2}|[^\/]\:)/)&&(a+=this.path.chars);
this.query.valid&&(a+="?"+this.query.chars);this.fragment.valid&&(a+="#"+this.fragment.chars);return a},set:function(a){if("string"!==typeof a)throw new TypeError;for(var b=URI.COMPONENT,c=0,e=b[0];void 0!==e;e=b[++c])URIComponent.URIString(a,this[e].type,this[e])},configurable:!0,enumerable:!0});Object.defineProperty(URI.prototype,"empty",{get:function(){for(var a=URI.COMPONENT,b=0,c=a[0];void 0!==c;c=a[++b])if(!this[c].empty)return!1;return!0},configurable:!0,enumerable:!0});
Object.defineProperty(URI.prototype,"valid",{get:function(){var a=(this.scheme.empty?0:1)|(this.user.empty?0:2)|(this.name.empty?0:4)|(this.port.empty?0:8)|(this.path.empty?0:16)|(this.query.empty?0:32)|(this.fragment.empty?0:64);return 0===a?!1:(0===(a&1)||this.scheme.valid)&&(0===(a&2)||this.user.valid)&&(0===(a&4)||this.name.valid)&&(0===(a&8)||this.port.valid)&&(0===(a&16)||this.path.valid&&(0!==(a&14)||-1===this.path.chars.search(1===(a&1)?/^\/{2}/:/^(?:\/{2}|[^\/]\:)/)))&&(0===(a&32)||this.query.valid)&&
(0===(a&64)||this.fragment.valid)},configurable:!0,enumerable:!0});URI.prototype.intersectionOf=function(a,b){if(!(a instanceof URI&&b instanceof URI))throw new TypeError;for(var c=URI.COMPONENT,e=0,d=c[0];void 0!==d;d=c[++e])this[d].chars=URIComponent.isEQ(a[d],b[d])?a[d].chars:"";return this};
URI.prototype.differenceOf=function(a,b){if(!(a instanceof URI&&b instanceof URI))throw new TypeError;for(var c=URI.COMPONENT,e=0,d=c[0];void 0!==d;d=c[++e])this[d].chars=URIComponent.isEQ(a[d],b[d])?"":a[d].chars;return this};URI.prototype.unionOf=function(a,b){if(!(a instanceof URI&&b instanceof URI))throw new TypeError;for(var c=URI.COMPONENT,e=0,d=c[0];void 0!==d;d=c[++e])this[d].chars=b[d].empty?a[d].chars:b[d].chars;return this};
URI.prototype.copyOf=function(a){if(!(a instanceof URI))throw new TypeError;for(var b=URI.COMPONENT,c=0,e=b[0];void 0!==e;e=b[++c])this[e].chars=a[e].chars;return this};URI.prototype.toString=function(){return this.string};Object.defineProperty(URI,"VERSION",{value:"0.3.0"});Object.defineProperty(URI,"COMPONENT",{value:"scheme user name port path query fragment".split(" "),enumerable:!0});Object.freeze(URI.COMPONENT);
URI.String=function(a,b){if(void 0===b)b=new URI;else if(!(b instanceof URI))throw new TypeError;b.string=a;return b};URI.Intersection=function(a,b,c){if(void 0===c)c=new URI;else if(!(c instanceof URI))throw new TypeError;c.intersectionOf(a,b);return c};URI.Difference=function(a,b,c){if(void 0===c)c=new URI;else if(!(c instanceof URI))throw new TypeError;c.differenceOf(a,b);return c};
URI.Union=function(a,b,c){if(void 0===c)c=new URI;else if(!(c instanceof URI))throw new TypeError;c.unionOf(a,b);return c};URI.Copy=function(a,b){if(void 0===b)b=new URI;else if(!(b instanceof URI))throw new TypeError;return b.copyOf(a)};URI.isEQ=function(a,b){if(!(a instanceof URI&&b instanceof URI))throw new TypeError;if(a===b)return!0;for(var c=this.COMPONENT,e=0,d=c[0];void 0!==d;d=c[++e])if(!URIComponent.isEQ(a[d],b[d]))return!1;return!0};URI.toString=function(){return"[URI-"+URI.VERSION+"]"};
function URIComponent(a){var b,c,e,d,f;switch(a){case this.TYPE_SCHEME:b=URIComponent.EXPR_SCHEME;c=URIComponent.EXPR_SCHEME_URI;e=URIComponent.FLAG_NORM_U;f=d=URIComponent.EXPR_ED_NONE;break;case this.TYPE_USER:b=URIComponent.EXPR_USER;c=URIComponent.EXPR_USER_URI;e=URIComponent.FLAG_NORM_EN|URIComponent.FLAG_NORM_DE|URIComponent.FLAG_NORM_E;d=URIComponent.EXPR_EN_XC;f=URIComponent.EXPR_DE_UNRESERVED;break;case this.TYPE_NAME:b=URIComponent.EXPR_NAME;c=URIComponent.EXPR_NAME_URI;e=URIComponent.FLAG_NORM_EN|
URIComponent.FLAG_NORM_DE|URIComponent.FLAG_NORM_U|URIComponent.FLAG_NORM_E;d=URIComponent.EXPR_EN;f=URIComponent.EXPR_DE_UNRESERVED;break;case this.TYPE_PORT:b=URIComponent.EXPR_PORT;c=URIComponent.EXPR_PORT_URI;e=URIComponent.FLAG_NORM_NONE;f=d=URIComponent.EXPR_ED_NONE;break;case this.TYPE_PATH:b=URIComponent.EXPR_PATH;c=URIComponent.EXPR_PATH_URI;e=URIComponent.FLAG_NORM_EN|URIComponent.FLAG_NORM_DE|URIComponent.FLAG_NORM_E;f=URIComponent.EXPR_DE_UNRESERVED;d=URIComponent.EXPR_EN_XCAS;break;case this.TYPE_QUERY:b=
URIComponent.EXPR_QUERY;c=URIComponent.EXPR_QUERY_URI;e=URIComponent.FLAG_NORM_EN|URIComponent.FLAG_NORM_DE|URIComponent.FLAG_NORM_E;d=URIComponent.EXPR_EN_XCASQ;f=URIComponent.EXPR_DE_UNRESERVED;break;case this.TYPE_FRAGMENT:b=URIComponent.EXPR_FRAGMENT;c=URIComponent.EXPR_FRAGMENT_URI;e=URIComponent.FLAG_NORM_EN|URIComponent.FLAG_NORM_DE|URIComponent.FLAG_NORM_E;d=URIComponent.EXPR_EN_XCASQ;f=URIComponent.EXPR_DE_UNRESERVED;break;default:throw new TypeError;}this.chars="";Object.defineProperty(this,
"type",{value:a,configurable:!0,enumerable:!0});Object.defineProperty(this,"componentExpression",{value:b,configurable:!0,enumerable:!0});Object.defineProperty(this,"uriExpression",{value:c,configurable:!0,enumerable:!0});Object.defineProperty(this,"normalizeEncodeExpression",{value:d,configurable:!0,enumerable:!0});Object.defineProperty(this,"normalizeDecodeExpression",{value:f,configurable:!0,enumerable:!0});Object.defineProperty(this,"normalizeFlags",{value:e,configurable:!0,enumerable:!0})}
Object.defineProperty(URIComponent.prototype,"TYPE_SCHEME",{value:1,enumerable:!0});Object.defineProperty(URIComponent.prototype,"TYPE_USER",{value:2,enumerable:!0});Object.defineProperty(URIComponent.prototype,"TYPE_NAME",{value:4,enumerable:!0});Object.defineProperty(URIComponent.prototype,"TYPE_PORT",{value:8,enumerable:!0});Object.defineProperty(URIComponent.prototype,"TYPE_PATH",{value:16,enumerable:!0});Object.defineProperty(URIComponent.prototype,"TYPE_QUERY",{value:32,enumerable:!0});
Object.defineProperty(URIComponent.prototype,"TYPE_FRAGMENT",{value:64,enumerable:!0});URIComponent.prototype.constructor=URIComponent;URIComponent.prototype.define=function(a){URIComponent.call(this,a);return this};
Object.defineProperty(URIComponent.prototype,"string",{get:function(){if(0!==this.chars.length&&-1===this.chars.search(this.componentExpression))throw new URIError;return this.chars},set:function(a){if("string"!==typeof a)throw new TypeError;if(""===a)this.chars="";else{var b=this.normalizeFlags;b&URIComponent.FLAG_NORM_DE&&(a=a.replace(this.normalizeDecodeExpression,function(a){return String.fromPctChar(a)}));b&URIComponent.FLAG_NORM_EN&&(a=a.replace(this.normalizeEncodeExpression,function(a){return a.pctCharAt(0)}));
b&URIComponent.FLAG_NORM_U&&(a=a.toLowerCase());b&URIComponent.FLAG_NORM_E&&(a=a.replace(/(?:%[0-9A-F]{2})+/gi,function(a){return a.toUpperCase()}));if(-1===a.search(this.componentExpression))throw new URIError;this.chars=a}},configurable:!0,enumerable:!0});
Object.defineProperty(URIComponent.prototype,"stringDecoded",{get:function(){return this.string.replace(/(?:%[0-9A-Z]{2})+/gi,function(a){return String.fromPctChar(a)})},set:function(a){if("string"!==typeof a)throw new TypeError;""===a?this.chars="":this.string=a.replace(/%/g,"%25")},configurable:!0,enumerable:!0});Object.defineProperty(URIComponent.prototype,"empty",{get:function(){return!this.chars.length},configurable:!0,enumerable:!0});
Object.defineProperty(URIComponent.prototype,"valid",{get:function(){return-1!==this.chars.search(this.componentExpression)},configurable:!0,enumerable:!0});URIComponent.prototype.copyOf=function(a){if(!(a instanceof URIComponent))throw new TypeError;this.type!==this.component&&this.constructor.call(this,a.type);this.chars=a.chars;return this};URIComponent.prototype.toString=function(){return this.string};Object.defineProperty(URIComponent,"VERSION",{value:"0.3.0"});
Object.defineProperty(URIComponent,"EXPR_SCHEME",{value:/^[a-z][+\-.0-9a-z]+$/,enumerable:!0});Object.defineProperty(URIComponent,"EXPR_SCHEME_URI",{value:/^([^/:]*)\:/,enumerable:!0});Object.defineProperty(URIComponent,"EXPR_USER",{value:/^([!$&'()*+,\-.0-9:;=A-Z_a-z~]|%[0-9A-F]{2})+$/,enumerable:!0});Object.defineProperty(URIComponent,"EXPR_USER_URI",{value:/^(?:[^/]*\:)?\/{2}([^@/?#]*)(?:@)/,enumerable:!0});
Object.defineProperty(URIComponent,"EXPR_NAME",{value:/^([!$&'()*+,\-.0-9;=A-Z_a-z~]|%[0-9A-F]{2})+$/,enumerable:!0});Object.defineProperty(URIComponent,"EXPR_NAME_URI",{value:/^(?:[^/]*\:)?\/{2}(?:[^/]*@)?([^:/?#]*)/,enumerable:!0});Object.defineProperty(URIComponent,"EXPR_PORT",{value:/^\d+$/,enumerable:!0});Object.defineProperty(URIComponent,"EXPR_PORT_URI",{value:/^(?:[^/]*\:)?\/{2}[^/]*\:([^@/?#]*)(?:\/|\?|#|$)/,enumerable:!0});
Object.defineProperty(URIComponent,"EXPR_PATH",{value:/^(?:[!$&'()*+,\-./0-9:;=@A-Z_a-z~]|%[0-9A-F]{2})+$/,enumerable:!0});Object.defineProperty(URIComponent,"EXPR_PATH_URI",{value:/^(?:(?:[^/]*\:)?\/{2}[^/?#]*|[^/]+?\:|(?=[^:]))([^?#]*)/,enumerable:!0});Object.defineProperty(URIComponent,"EXPR_QUERY",{value:/^(?:[!$&'()*+,\-./0-9:;=?@A-Z_a-z~]|%[0-9A-F]{2})+$/,enumerable:!0});Object.defineProperty(URIComponent,"EXPR_QUERY_URI",{value:/\?([^#]*)/,enumerable:!0});
Object.defineProperty(URIComponent,"EXPR_FRAGMENT",{value:/^(?:[!$&'()*+,\-./0-9:;=?@A-Z_a-z~]|%[0-9A-F]{2})+$/,enumerable:!0});Object.defineProperty(URIComponent,"EXPR_FRAGMENT_URI",{value:/#(.*)$/,enumerable:!0});Object.defineProperty(URIComponent,"EXPR_ED_NONE",{value:/$^/,enumerable:!0});Object.defineProperty(URIComponent,"EXPR_DE_UNRESERVED",{value:/(?:%(?:2[DE]|3[0-9]|[46][1-9A-F]|5[0-9AF]|6[0-9AE]))+/gi,enumerable:!0});
Object.defineProperty(URIComponent,"EXPR_EN",{value:/[\u0000-\u0020\u0022\u0023\u002F\u003A\u003C\u003E-\u0040\u005B-\u005E\u0060\u007B-\u007D\u007F-\uFFFF]/g,enumerable:!0});Object.defineProperty(URIComponent,"EXPR_EN_XC",{value:/[\u0000-\u0020\u0022\u0023\u002F\u003C\u003E-\u0040\u005B-\u005E\u0060\u007B-\u007D\u007F-\uFFFF]/g,enumerable:!0});Object.defineProperty(URIComponent,"EXPR_EN_XCAS",{value:/[\u0000-\u0020\u0022\u0023\u003C\u003E\u003F\u005B-\u005E\u0060\u007B-\u007D\u007F-\uFFFF]/g,enumerable:!0});
Object.defineProperty(URIComponent,"EXPR_EN_XCASQ",{value:/[\u0000-\u0020\u0022\u0023\u003C\u003E\u005B-\u005E\u0060\u007B-\u007D\u007F-\uFFFF]/g,enumerable:!0});Object.defineProperty(URIComponent,"FLAG_NORM_NONE",{value:0,enumerable:!0});Object.defineProperty(URIComponent,"FLAG_NORM_U",{value:1,enumerable:!0});Object.defineProperty(URIComponent,"FLAG_NORM_E",{value:2,enumerable:!0});Object.defineProperty(URIComponent,"FLAG_NORM_EN",{value:4,enumerable:!0});
Object.defineProperty(URIComponent,"FLAG_NORM_DE",{value:8,enumerable:!0});URIComponent.URIString=function(a,b,c){if("string"!==typeof a)throw new TypeError;if(void 0===c)c=new URIComponent(b);else if(c instanceof URIComponent)c.type!==b&&URIComponent.call(c,b);else throw new TypeError;if(a=a.match(c.uriExpression))try{c.string=a[1]}catch(e){c.chars=a[1]}return c};
URIComponent.ComponentString=function(a,b,c){if(void 0===c)c=new URIComponent(b);else if(c instanceof URIComponent)c.type!==b&&URIComponent.call(c,b);else throw new TypeError;c.string=a;return c};URIComponent.Copy=function(a,b){return URIComponent.ComponentString(a.chars,a.type,b)};URIComponent.isEQ=function(a,b){if(!(a instanceof URIComponent&&b instanceof URIComponent))throw new TypeError;return a.type===b.type&&a.chars===b.chars};
URIComponent.toString=function(){return"[URIComponent-"+URIComponent.VERSION+"]"};function URIKeyValue(a,b,c){StringKeyValue.call(this,a,b,c)}URIKeyValue.prototype=Object.create(StringKeyValue.prototype);URIKeyValue.prototype.constructor=URIKeyValue;Object.defineProperty(URIKeyValue,"VERSION",{value:"0.3.0"});URIKeyValue.String=function(a,b,c,e,d){if(void 0===d)d=new URIKeyValue;else if(!(d instanceof URIKeyValue))throw new TypeError;return StringKeyValue.String(a,b,c,e,d)};
URIKeyValue.QueryString=function(a,b,c,e,d){if(void 0===d)d=new URIKeyValue;else if(!(d instanceof URIKeyValue))throw new TypeError;if(void 0===b)b=URIKeyValue.DELIMITER_DEFAULT_KEY;else if("string"!==typeof b||1!==b.length)throw new TypeError;return StringKeyValue.String(a.replace(/\?/g,b),b,c,e,d)};URIKeyValue.Key=function(a,b,c,e,d,f){if(void 0===f)f=new URIKeyValue;else if(!(f instanceof URIKeyValue))throw new TypeError;return StringKeyValue.Key(a,b,c,e,d,f)};
URIKeyValue.Copy=function(a,b){if(void 0===b)b=new URIKeyValue;else if(!(b instanceof URIKeyValue))throw new TypeError;b.copyOf(a);return b};URIKeyValue.toString=function(){return"[URIKeyValue-"+URIKeyValue.VERSION+"]"};function URINameComponent(){URIComponent.call(this,this.TYPE_NAME)}URINameComponent.prototype=Object.create(URIComponent.prototype);URINameComponent.prototype.constructor=URINameComponent;URINameComponent.prototype.define=function(){URIComponent.call(this,this.TYPE_NAME);return this};
Object.defineProperty(URINameComponent.prototype,"stringReverse",{get:function(){var a=this.string.split(".");a.reverse();return a.join(".")},set:function(a){if("string"!==typeof a||""===a)throw new TypeError;a=a.split(".");a.reverse();this.string=a.join(".")},configurable:!0,enumerable:!0});
Object.defineProperty(URINameComponent.prototype,"segment",{get:function(){var a=this.string.split(".");a.reverse();return a},set:function(a){if(!(a instanceof Array)||0===a.length)throw new TypeError;for(var b="",c=a.length-1;-1<c;c--){if("string"!==typeof a[c]||""===a[c])throw new TypeError;b+=a[c]+"."}this.string=b.substring(0,b.length-1)},configurable:!0,enumerable:!0});
Object.defineProperty(URINameComponent.prototype,"ip4",{get:function(){return-1!==this.chars.search(URINameComponent.EXPR_IP4)},configurable:!0,enumerable:!0});Object.defineProperty(URINameComponent.prototype,"dns",{get:function(){return-1===this.chars.search(URINameComponent.EXPR_IP4)&&-1!==this.chars.search(URINameComponent.EXPR_DNS)},configurable:!0,enumerable:!0});
URINameComponent.prototype.intersectionOf=function(a,b){if(!(a instanceof URINameComponent&&b instanceof URINameComponent))throw new TypeError;for(var c=a.segment,e=b.segment,d=c.length-1;-1<d&&c[d]===e[d];--d);this.segment=c.slice(d+1);return this};URINameComponent.prototype.differenceOf=function(a,b){if(!(a instanceof URINameComponent&&b instanceof URINameComponent))throw new TypeError;for(var c=a.segment,e=b.segment,d=c.length-1;-1<d&&c[d]===e[d];--d);this.segment=c.slice(0,d);return this};
URINameComponent.prototype.toString=function(a){if(void 0===a)a=!1;else if("boolean"!==typeof a)throw new TypeError;return a?this.stringReverse:this.string};Object.defineProperty(URINameComponent,"VERSION",{value:"0.3.0"});Object.defineProperty(URINameComponent,"EXPR_IP4",{value:/^(?:(?:^|\.)((?:[1-9]|1[0-9])?[0-9]|2[0-4][0-9]|25[0-5])){4}$/,enumerable:!0});Object.defineProperty(URINameComponent,"EXPR_DNS",{value:/^(?:[0-9a-z](?:[\-0-9a-z]*[0-9a-z])?\.)*[0-9a-z](?:[\-0-9a-z]*[0-9a-z])?\.?$/,enumerable:!0});
URINameComponent.URIString=function(a,b){if(void 0===b)b=new URINameComponent;else if(!(b instanceof URINameComponent))throw new TypeError;return URIComponent.URIString(a,b.TYPE_NAME,b)};URINameComponent.ComponentString=function(a,b,c){if(void 0===b)b=!1;else if("boolean"!==typeof b)throw new TypeError;if(void 0===c)c=new URINameComponent;else if(!(c instanceof URINameComponent))throw new TypeError;b?c.stringReverse=a:c.string=a;return c};
URINameComponent.Segment=function(a,b){if(void 0===b)b=new URINameComponent;else if(!(b instanceof URINameComponent))throw new TypeError;b.segment=a;return b};URINameComponent.Intersection=function(a,b,c){if(void 0===c)c=new URINameComponent;else if(!(c instanceof URINameComponent))throw new TypeError;return c.intersectionOf(a,b)};URINameComponent.Difference=function(a,b,c){if(void 0===c)c=new URINameComponent;else if(!(c instanceof URINameComponent))throw new TypeError;return c.differenceOf(a,b)};
URINameComponent.Copy=function(a,b){if(!(a instanceof URINameComponent))throw new TypeError;return URINameComponent.ComponentString(a.chars,!1,b)};URINameComponent.toString=function(){return"[URINameComponent-"+URINameComponent.VERSION+"]"};function URIPathComponent(){URIComponent.call(this,this.TYPE_PATH)}URIPathComponent.prototype=Object.create(URIComponent.prototype);URIPathComponent.prototype.constructor=URIPathComponent;
URIPathComponent.prototype.define=function(){URIComponent.call(this,this.TYPE_PATH);return this};Object.defineProperty(URIPathComponent.prototype,"stringResolved",{get:function(){for(var a=this.string.split("/"),b=a.length-1,c=[],e=0,d=0,f=a[0];void 0!==f;f=a[++d])switch(f){case ".":0!==d&&d!==b||c.push(f);continue;case "..":0!==e&&d!==b?(c.pop(),e--):c.push(f);continue;case "":c.push(f);0!==d&&e++;continue;default:c.push(f),e++}return c.join("/")},configurable:!0,enumerable:!0});
Object.defineProperty(URIPathComponent.prototype,"segment",{get:function(){return this.string.split("/")},set:function(a){if(!(a instanceof Array)||0===a.length)throw new TypeError;for(var b="",c=0,e=a.length;c<e;c++){if("string"!==typeof a[c])throw new TypeError;b+=a[c]+"/"}this.string=b.substring(0,b.length-1)},configurable:!0,enumerable:!0});
Object.defineProperty(URIPathComponent.prototype,"absolute",{get:function(){return"/"===this.chars[0]},set:function(a){if("boolean"!==typeof a)throw new TypeError;a?"/"!==this.chars[0]&&(this.chars="/"+this.chars):"/"===this.chars[0]&&(this.chars=this.chars.substring(1))},configurable:!0,enumerable:!0});
Object.defineProperty(URIPathComponent.prototype,"lastSegment",{get:function(){var a=this.string,b=a.lastIndexOf("/");return-1===b?a:a.substring(b+1)},set:function(a){if("string"!==typeof a||-1===a.search(URIComponent.PATH_SEGMENT))throw new TypeError;var b=this.chars,c=b.lastIndexOf("/");this.string=-1===c?a:b.substring(0,c+1)+a},configurable:!0,enumerable:!0});
URIPathComponent.prototype.intersectionOf=function(a,b){if(!(a instanceof URIPathComponent&&b instanceof URIPathComponent))throw new TypeError;for(var c=a.segment,e=b.segment,d=0,f=c.length;d<f&&c[d]===e[d];++d);this.segment=c.slice(0,d);return this};URIPathComponent.prototype.differenceOf=function(a,b){if(!(a instanceof URIPathComponent&&b instanceof URIPathComponent))throw new TypeError;for(var c=a.segment,e=b.segment,d=0,f=c.length;d<f&&c[d]===e[d];++d);this.segment=c.slice(d);return this};
URIPathComponent.prototype.resolve=function(){this.chars=this.stringResolved;return this};Object.defineProperty(URIPathComponent,"VERSION",{value:"0.2.3"});URIPathComponent.URIString=function(a,b){if(void 0===b)b=new URIPathComponent;else if(!(b instanceof URIPathComponent))throw new TypeError;return URIComponent.URIString(a,b.TYPE_PATH,b)};URIPathComponent.ComponentString=function(a,b){if(void 0===b)b=new URIPathComponent;else if(!(b instanceof URIPathComponent))throw new TypeError;b.string=a;return b};
URIPathComponent.Segment=function(a,b){if(void 0===b)b=new URIPathComponent;else if(!(b instanceof URIPathComponent))throw new TypeError;b.segment=a;return b};URIPathComponent.Intersection=function(a,b,c){if(void 0===c)c=new URIPathComponent;else if(!(c instanceof URIPathComponent))throw new TypeError;return c.intersection(a,b)};URIPathComponent.Difference=function(a,b,c){if(void 0===c)c=new URIPathComponent;else if(!(c instanceof URIPathComponent))throw new TypeError;return c.difference(a,b)};
URIPathComponent.Copy=function(a,b){if(!(a instanceof URIPathComponent))throw new TypeError;return URIPathComponent.ComponentString(a.chars,b)};URIPathComponent.toString=function(){return"[URIPathComponent-"+URIPathComponent.VERSION+"]"};module.exports.StringKeyValue=StringKeyValue;module.exports.URI=URI;module.exports.URIComponent=URIComponent;module.exports.URIKeyValue=URIKeyValue;module.exports.URINameComponent=URINameComponent;module.exports.URIPathComponent=URIPathComponent;
